# Understand when and why to use Razor Pages

## The benefits of Razor Pages
Razor Pages is a server-side, page-centric programming model for building web UI with ASP.NET Core. Benefits include:
* Easy setup for dynamic web apps using HTML, CSS, and C#
* Organized files by feature for easier maintenance.
* Combines markup with server-side C# code using Razor syntax.

Razor pages utilize the [Razor](https://learn.microsoft.com/en-us/aspnet/core/mvc/views/razor) for embedding server-side code into webpages. Razor syntax combines HTML and [C#](https://dotnet.microsoft.com/languages/csharp) to define the dynamic rendering logic. This means you can use **C#** variables and methods within your HTML markup to generate dynamic web content on the server at runtime. It's important to understand that Razor Pages are not the replacement for HTML, CSS, or JavaScript. They are a way to combine these technologies to create dynamic web content.

### Separation of concerns
Razor Pages enforces separation of concerns with a C# `PageModel` class, encapsulating data properties and logic operations scoped to its Razor page, and defining page handlers for HTTP requests. The `PageModel` class is a [partial class](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/partial-classes-and-methods) that is automatically generated by the ASP.NET Core project template. The `PageModel` class is located in the `Pages` folder and is named after the Razor page. For example, the `PageModel` class for the `Index.cshtml` Razor page is named `IndexModel.cs`.

## When to use Razor Pages
Use Razor Pages in your ASP.NET Core app when you:
* Want to generate dynamic web UI.
* Prefer a page-focused approach.
* Want to reduce duplication with partial views.

Razor Pages simplifies ASP.NET Core page organization by keeping related pages and their logic together in their own namespace and directory.

--------
## Exercise - Customize the project
Your team has split up the work for the pizza inventory management app. Your teammates have created the ASP.NET Core web app for you, and they've already built a service to **read** and **write** pizzas to a database. You've been assigned to **work on the Pizza List page**, which will **display a list of pizzas** and **allow you to add new pizzas to the database**. You'll start by taking a tour of the project to understand how it's organized.

### Obtain the project files
Obtain the project files and open them in Visual Studio Code with the following steps:
1. Open a command shell and clone the project from GitHub using the command line:
```
git clone https://github.com/MicrosoftDocs/mslearn-create-razor-pages-aspnet-core
```

2. Navigate to the `mslearn-create-razor-pages-aspnet-core` directory and open the project in VS code:
```
cd mslearn-create-razor-pages-aspnet-core
code .
```

### Review your teammates' work
Let's take a moment to get familiar with the existing code in the ContosoPizza folder. The project is an ASP.NET Core web app created using the `dotnet new webapp` command. The changes your teammmates made are described below.

```
NB) Don't spend too much time reviewing these changes. Your teammates have already done the work to create the database and the service to read and write pizzas to the database, but they didn't make any UI changes. You'll be building a UI that consumes their service.
```

* A **Models** folder was added to the project.
    * The model folder contains a `pizza` class that represents a pizza.
* A **Data** folder was added to the project
    * The data folder contains a `PizzaContext` class that represents the datatbase context. It inherits from the `DbContext` class from **Entity Framework Core**. Entity Framework Core is an object-relational mapper (ORM) that makes it easier to work with databases.
* A **Service** folder was added to the project.
    * The services folder contains a `PizzaService` class that exposes methods to list and add pizzas.
    * The `PizzaService` class uses the `PizzaContext` class to read and write pizzas to the database.
    * The class is registered for dependency injection in **Program.cs** (line 10).

Entity Framework Core generated a few things, too:
* A **Migrations** folder was generated.
    * The migrations folder contains code to create the database schema.

-------
## Review the Razor Pages project structure
Everything else in the project is unchanged from how the project was created. The following table describes the project structure that generated by the `dotnet new webapp` command.

| **Name**               |  **Description**                                        |
|------------------------|---------------------------------------------------------|
| Pages/                 | Contains Razor Pages and supproting files. Each Razor   |
|                        | page has a *.cshtml* and a *.cshtml.cs* `PageModel`     |
|                        | class file.                                             |
|------------------------|---------------------------------------------------------|
| wwwroot/               | Contains static asset files like HTML, JavaScript, and  |
|                        | CSS.                                                    |
|------------------------|---------------------------------------------------------|
| ContosoPizza.csproj    | Contains project configuration metadata, such as        |
|                        | dependencies                                            |
|------------------------|---------------------------------------------------------|
| Program.cs             | Serves as the app's entry point and configures app      |
|                        | behavior, like routing.                                 |
|------------------------|---------------------------------------------------------|

Other noteworthy observations:
    * **Razor page files and their paired `PageModel` class file**
        Razor pages are stored in the *Pages* directory. As noted above, each Razor page has a *.cshtml* file and a *.cshtml.cs* `PageModel` class file. The `PageModel` class allows separation of a Razor page's logic and presentation, defines page handlers for requests, and encapsulates data properties and logic scoped to its Razor page.

    * **The Pages directory structure and routing request** 
        Razor Pages uses the Pages directory structure as the convention for routing request. The following table shows how URLs map to filenames:

        | **URL**                         | **Maps to Razor page**                  |
        |---------------------------------|-----------------------------------------|
        | `www.domain.com`                | Pages/Index.cshtml                      |
        |---------------------------------|-----------------------------------------|
        | `www.domain.com/Index`          | Pages/Index.cshtml                      |
        |---------------------------------|-----------------------------------------|
        | `www.domain.com/Privacy`        | Pages/Privacy.cshtml                    |
        |---------------------------------|-----------------------------------------|
        | `www.domain.com/Error`          | Pages/Error.cshtml                      |
        |---------------------------------|-----------------------------------------|

        Subfolders in the Pages directory are used to organize Razor pages. Foe example, if there were a *Pages/Products* directory, the *URLs* would reflect that structure:

        | **URL**                          | **Maps to Razor page**                  |
        |----------------------------------|-----------------------------------------|
        | `www.domain.com/Products`        | Pages/Products/Index.cshtml             |
        |----------------------------------|-----------------------------------------|
        | `www.domain.com/Products/Index`  | Pages/Products/Index.cshtml             |
        |----------------------------------|-----------------------------------------|
        |`www.domain.com/Products/Create   | Pages/Products/Create.cshtml            |
        |----------------------------------|-----------------------------------------|

    * **Layout and other shared files**
        There are several files that are shared across multiple pages. These files determine common layout elements and page imports. The following table describes the purpose of each file.

        | **File**                                        | **Description**                                          |
        |-------------------------------------------------|----------------------------------------------------------|
        | _ViewImports.cshtml                             | Imports namespaces and classes that are used across      |
        |                                                 | multiple pages.                                          |
        |-------------------------------------------------|----------------------------------------------------------|
        | _ViewStart.cshtml                               | Specfied the default layout for all Razor pages.         |
        |-------------------------------------------------|----------------------------------------------------------|
        | Pages/Shared/_Layout.cshtml                     | This is the layout specified by the `_ViewStart.cshtml`  |
        |                                                 | file. Implements common layout elements across multiple  |
        |                                                 | pages                                                    |
        |-------------------------------------------------|----------------------------------------------------------|
        | Pages/Shared/_ValidationScriptsPartial.cshtml   | Provides validation functionality to all pages           |
        |-------------------------------------------------|----------------------------------------------------------|

-----------
## Run the project for the first time
Let's run the project so we can see it in action.
    1. Right-click in the **ContosoPizza** folder in the **Explorer** nad select **Open in Integrated Terminal**. This opens a  terminal window in the context of the project folder.

    2. In the terminal window, enter the following command:
    ```
    dotnet watch
    ```

    This command:
    * Builds the project.
    * Starts the app.
    * Watches for file changes and restarts the app when it detects a change.

    3. The IDE prompts you to open the app in a browser. Select **Open in Browser**.

    4. Compare the rendered home page to **Pages/Index.cshtml** in the IDE:
        * Observe the combination of HTML, Razor Syntax, and C# code in the file.
            * Razor Syntax is denoted by `@` characters.
            * C# code is enclosed in `@{ }` blocks. Take note of the directives at the top of the file:
            * The `@page` directive specifies that this file is a Razor page.
            * The `@model` directive specifies the model type for the page (in this case, `IndexModel`, which is defined in **Pages/Index.cshtml.cs**).
        * Review the C# code block.
            * The code sets the value of the `Title` item within the `ViewData` dictionary to "Home page".
            * The `ViewData` dictionary is used to pass data between the Razor page and the `IndexModel` class.
            * At runtime, the `Title` value is used to set the page's `<title>` element.

-----------
## Customize the landing page
Let's make a few changes to the landing page to make it more relevant to the pizza app.
1. In **Pages/Index.cshtml**, replace the code in the C# code block with the following code:
```cs
ViewData["Title"] = "The Home for Pizza Lovers";
TimeSpan timeInBusiness = DateTime.Now - new DateTime(2018, 8, 14);
```

The preceding code:
    * Sets the value of the `Title` item within the `ViewData` dictionary to "The Home for Pizza Lovers".
    * calculates the amount of time that has passed since the business opened.

2. Modify the HTML as follows:
    * Replace the `<h1>` element with the following code:
    ```html
    <h1 class="display-4">Welcome to Contoso Pizza</h1>
    ```

    * Replace the `<p>` element with the following code:
    ```html
    <p class="lead">The best pizza in town for @Convert.ToInt32(timeInBusiness.TotalDays) days!</p>
    ```

The preceding code:
    * Changes the heading to  "welcome to Contoso Pizza".
    * Display the number of days that have passed since the business opened.
        * The `@` character is used to switch from HTML to Razor Syntax.
        * The `Convert.ToInt32` method is used to convert the `totalDays` property of the `timeInBusiness` variable to an integer.
        * The `convert` class is part of the `System` namespace, which is imported automaatically by the `<ImplicitUsings>` element in the **ContosoPizza.csproj** file.

3. Save the file. The browser tab with the app automatically refreshes to display the changes. If you're using GitHub Codespaces, the file saves automatically, but you'll need to refresh the browser tab manually.

--------
# Exercise - Add a new Razor Page
In the previous unit, you obtained the source code for the Contoso Pizza project, and then you made some simple changes to the home page. In this unit, you'll add a new Razor page to the project.

## Create the Pizza List page
To create a new Razor page, you'll use the .NET CLI.
1. Since the terminal is blocked by the `dotnet watch` command, open another terminal by right-clocking on the **ContosoPizza** folder in the **Explorer** and select **Open in Integrated Terminal**.

2. In the terminal window, enter the following command: 
```cs
dotnet new page --name PizzaList --namespace ContosoPizza.Pages --output Pages
```
The preceeding command:
    * Creates the following files in the `ContosoPizza.Pages` namespace:
        * **PizzaList.cshtml**-The Razor page.
        * **PizzaList.cshtml.cs**-The accompanying `PageModel` class.
    * Stores both files in the project's **Pages** subdirectory.

3. In **Pages/PizzaList.cshtml**, add the following code inside the `@{ }` code block:
```cs
ViewData["Title"] = "Pizza List 🍕";
```

this sets the `<title>` element for the page.

4. At the end of the file, add the following code:
```html
<h1>Pizza List 🍕</h1>

<!-- New Pizza form will go here -->

<!-- List of pizzas will go here -->
```
This adds a heading to the page, as well as two HTML comment placeholders for functionality needed later.

5. Save the file.
6. Return to the terminal running `dotnet watch` and press **Ctrl+R** to reload the app and detect the new files.

------
# Add the Pizza List page to the navigation menu
This would be a good time to test the page, but you can't do that yet because the page isn't linked in the navigation menu. You'll do that now.

1. Open *Pages/Shared/_Layout.cshtml*.
2. In the `<ul>` element with the `navbar-nav` class, note the `<ul>` elements that contain the links to the *Home* and *Privacy* pages. Add the following code to the list, after the `<ul>` element containing the *Privacy* link:
```html
<li class="nav-item">
    <a class="nav-link text-dark" asp-area="" asp-page="/PizzaList">Pizza List 🍕</a>
</li>
```
This adds a link to the *PizzaList* page to the navigation menu.

3. Save the file. The browser tab with the app automatically refreshes to display the changes.
4. Select the Pizza List 🍕 link in the navigation menu. The Pizza List page appears.

------
# Register the PizzaService class with the dependency injection container.
The Pizza List page depends on the `PizzaService` object to retrieve the list of pizzas. You'll use dependency injection to provide the `PizzaService` object to the page. In order for that to happen, you must register the `PizzaService` class with the container.

1. Open **Program.cs**.
2. In the section that adds services to the container, add the following code:
```cs
builder.Services.AddScoped<PizzaService>();
```
This code registers the `PizzaService` class with the dependency injection container. The `AddScoped` method indicates that a new `PizzaService` object should be created for each `HTTP` request. Now the `PizzaService` can be injected into any Razor page.

3. Save file.


-----
# Display a list of pizzas
Let's modify the `PageModel` class for the Pizza List page to retrieve the list of pizzas from the `PizzaService` object and store it in a property.

1. Open *Pages/PizzaList.cshtml.cs*
2. Add the following `using` statement to the top of the file:
```cs
using ContosoPizza.Models;
using ContosoPizza.Services;
```
These statements import the Pizza and PizzaService types you'll use in the page.

3. Inside the ContosoPizza.Pages namespace block, replace the entire PizzaListModel class with the following code:
```cs
public class PizzaListModel : PageModel
{
    private readonly PizzaService _service;
    public IList<Pizza> PizzaList { get; set; } = default!;

    public PizzaListModel(PizzaService service)
    {
        _service = service;
    }

    public void OnGet()
    {
        PizzaList = _service.GetPizzas();
    }
}
```
In the preceding code:

* A private readonly `PizzaService` named `_service` is created. This variable will hold a reference to a `PizzaService` object.
    * The `readonly` keyword indicates that the value of the `_service` variable can't be changed after it's set in the constructor.
* A `PizzaList` property is defined to hold the list of pizzas.
    * The `IList<Pizza>` type indicates that the `PizzaList` property will hold a list of `Pizza` objects.
    * `PizzaList` is initialized to `default!` to indicate to the compiler that it will be initialized later, so null safety checks aren't required.
* The constructor accepts a `PizzaService` object.
    * The `PizzaService` object is provided by dependency injection.
* An `OnGet` method is defined to retrieve the list of pizzas from the `PizzaService` object and store it in the `PizzaList` property.

```
If you need help understanding null safety, see [Null safety in C#](https://learn.microsoft.com/en-us/training/modules/csharp-null-safety/).
```

4. Save file.
5. Return to the terminal running `dotnet watch` and press **Ctrl+R** to reload the app with the registered service and the new constructor for `PizzaListModel`.

-----
# Display the list of pizzas
Now that the page has access to the list of pizzas, you'll use that list to display the pizzas on the page.

1. Open *Pages/PizzaList.cshtml*.
2. Replace the <!-- List of pizzas will go here --> comment with the following code:
```html
<table class="table mt-5">
    <thead>
        <tr>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col">Size</th>
            <th scope="col">Gluten Free</th>
            <th scope="col">Delete</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var pizza in Model.PizzaList)
    {
        <tr>
            <td>@pizza.Name</td>
            <td>@($"{pizza.Price:C}")</td>
            <td>@pizza.Size</td>
            <td>@(pizza.IsGlutenFree ? "✔️" : string.Empty)</td>
            <td>
                <form method="post" asp-page-handler="Delete" asp-route-id="@pizza.Id">
                    <button class="btn btn-danger">Delete</button>
                </form>
            </td>
        </tr>
    }
    </tbody>
</table>
```
In the preceding code:

* A `<table>` element is created to display the list of pizzas.
* A `<thead>` element is created to hold the table header.
* The `@foreach` statement inside the `<tbody>` iterates over the list of pizzas.
    * The `Model` property refers to the `PizzaListModel` object that was created in the code-behind file.
    * The `PizzaList` property refers to the `PizzaList` property that was defined in the code-behind file.
* Each iteration of the `@foreach` statement creates a `<tr>` element to hold the pizza data:
    * Razor syntax is used to display the pizza data in the `<td>` elements. This syntax is used to display the properties of the Pizza object that's stored in the pizza variable.
    * `Price` is formatted using C# string interpolation.
    * A ternary expression is used to display the value of the `IsGlutenFree` property as "✔️" or a blank cell.
    * A form is created to delete the pizza.
        * The `asp-page-handler` attribute indicates that the form should be submitted to the `Delete` handler in the code-behind file. You'll create that handler in a later unit.
        * The `asp-route-id` attribute indicates that the `Id` property of the `Pizza` object should be passed to the `Delete` handler.

3. Save the file. In the browser, the Pizza List page refreshes with the list of pizzas.

![pic](https://learn.microsoft.com/en-us/training/aspnetcore/create-razor-pages-aspnet-core/media/pizza-list.png)




